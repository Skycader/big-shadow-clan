<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ö–ª–∞–Ω –ë–æ–ª—å—à–æ–π –¢–µ–Ω–∏ - –ê–≥–µ–Ω—Ç—ã</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --base03: #002b36;
        --base02: #073642;
        --base01: #586e75;
        --base00: #657b83;
        --base0: #839496;
        --base1: #93a1a1;
        --base2: #eee8d5;
        --base3: #fdf6e3;

        --yellow: #b58900;
        --orange: #cb4b16;
        --red: #dc322f;
        --magenta: #d33682;
        --violet: #6c71c4;
        --blue: #268bd2;
        --cyan: #2aa198;
        --green: #859900;

        --primary: var(--base03);
        --secondary: var(--base02);
        --accent: var(--yellow);
        --text: var(--base1);
        --text-muted: var(--base00);
        --border: var(--base01);
        --success: var(--green);
        --danger: var(--red);
        --warning: var(--orange);
        --skill-bg: var(--base02);
        --skill-hover: var(--base01);
        --rank-bg: rgba(181, 137, 0, 0.15);
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: var(--primary);
        color: var(--text);
        line-height: 1.6;
        min-height: 100vh;
      }

      .header {
        background: var(--secondary);
        padding: 20px 40px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid var(--accent);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        cursor: pointer;
      }

      .header-title {
        font-size: 2.2em;
        font-weight: 900;
        letter-spacing: 2px;
        color: var(--accent);
        text-shadow: 0 0 10px rgba(181, 137, 0, 0.3);
      }

      .header-controls {
        display: flex;
        align-items: center;
        gap: 25px;
      }

      .balance-container {
        display: flex;
        align-items: center;
        gap: 10px;
        background: linear-gradient(135deg, var(--accent), var(--yellow));
        padding: 15px 25px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(181, 137, 0, 0.4);
      }

      .balance-container:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(181, 137, 0, 0.6);
      }

      .balance-label {
        font-size: 0.95em;
        color: var(--base03);
        font-weight: 600;
      }

      .balance-value {
        font-size: 2.2em;
        font-weight: 900;
        color: var(--base03);
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        min-width: 80px;
        text-align: center;
      }

      .balance-years {
        font-size: 1em;
        color: var(--base03);
        font-weight: 600;
      }

      .header-icon {
        width: 45px;
        height: 45px;
        background: var(--secondary);
        border: 2px solid var(--accent);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--accent);
        font-size: 1.3em;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
      }

      .header-icon:hover {
        background: var(--accent);
        color: var(--base03);
        transform: rotate(15deg) scale(1.1);
        box-shadow: 0 5px 15px rgba(181, 137, 0, 0.5);
      }

      .header-icon.export {
        background: var(--green);
        color: white;
        border-color: var(--green);
      }
      .header-icon.export:hover {
        background: var(--success);
      }
      .header-icon.import {
        background: var(--blue);
        color: white;
        border-color: var(--blue);
      }
      .header-icon.import:hover {
        background: var(--cyan);
      }
      .header-icon.copy {
        background: var(--cyan);
        color: white;
        border-color: var(--cyan);
      }
      .header-icon.copy:hover {
        background: var(--blue);
      }

      .container {
        max-width: 1400px;
        margin: 30px auto;
        padding: 0 20px;
      }

      .agents-table {
        width: 100%;
        border-collapse: collapse;
        background: var(--secondary);
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        margin-bottom: 30px;
      }

      .agents-table th {
        background: linear-gradient(
          135deg,
          var(--accent) 0%,
          var(--yellow) 100%
        );
        padding: 15px;
        text-align: left;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-size: 0.9em;
        color: var(--base03);
      }

      .agents-table tr {
        border-bottom: 1px solid var(--border);
      }

      .agents-table td {
        padding: 12px 15px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .agents-table tr:hover {
        background: rgba(181, 137, 0, 0.1);
      }

      .agents-table tr:last-child td {
        border-bottom: none;
      }

      .agents-table td:first-child {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .agent-avatar {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        background: var(--base01);
        object-fit: cover;
        border: 2px solid var(--accent);
      }

      .status {
        display: inline-block;
        border-radius: 20px;
        padding: 0px 5px;
        font-size: 0.85em;
        font-weight: 600;
        text-transform: uppercase;
      }

      .status.waiting {
        background: var(--blue);
        color: white;
      }

      .status.active {
        background: var(--green);
        color: white;
      }

      .rank-container {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        text-align: center;
      }

      .rank {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 90px;
      }

      .rank-name {
        font-size: 1.1em;
        font-weight: 600;
        color: var(--yellow);
        margin-bottom: 5px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .rank-badge {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 8px;
        background: var(--rank-bg);
        font-size: 1em;
        font-weight: 700;
        color: var(--yellow);
        line-height: 1.4;
        white-space: pre-line;
        text-align: center;
        min-width: 60px;
      }

      .add-agent-btn {
        display: block;
        width: 250px;
        margin: 20px auto;
        padding: 15px 30px;
        background: linear-gradient(
          135deg,
          var(--accent) 0%,
          var(--yellow) 100%
        );
        color: var(--base03);
        border: none;
        border-radius: 50px;
        font-size: 1.1em;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(181, 137, 0, 0.4);
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      .add-agent-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(181, 137, 0, 0.6);
      }

      .add-agent-btn:active {
        transform: translateY(1px);
      }

      .profile-container {
        display: none;
        max-width: 1300px;
        margin: 30px auto;
        background: var(--secondary);
        border-radius: 15px;
        padding: 40px;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.6);
        border: 2px solid var(--accent);
      }

      .profile-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid var(--border);
        position: relative;
      }

      .profile-title {
        font-size: 2.5em;
        font-weight: 700;
        color: var(--accent);
      }

      .back-btn {
        padding: 12px 30px;
        background: linear-gradient(135deg, var(--accent), var(--yellow));
        color: var(--base03);
        border: none;
        border-radius: 30px;
        cursor: pointer;
        font-weight: 700;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-size: 1.1em;
        box-shadow: 0 3px 10px rgba(181, 137, 0, 0.3);
      }

      .back-btn:hover {
        background: linear-gradient(135deg, var(--yellow), #d7af00);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(181, 137, 0, 0.5);
      }

      .delete-btn {
        padding: 12px 30px;
        background: linear-gradient(135deg, var(--danger), #a12a26);
        color: white;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        font-weight: 700;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-size: 1.1em;
        box-shadow: 0 3px 10px rgba(220, 53, 69, 0.4);
      }

      .delete-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(220, 53, 69, 0.6);
      }

      .copy-btn {
        width: 45px;
        height: 45px;
        background: linear-gradient(135deg, var(--cyan), var(--blue));
        border: 2px solid var(--cyan);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2em;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-left: 15px;
        box-shadow: 0 3px 10px rgba(42, 161, 152, 0.3);
      }

      .copy-btn:hover {
        background: linear-gradient(135deg, var(--blue), #1e6bb8);
        transform: scale(1.1);
        box-shadow: 0 5px 15px rgba(42, 161, 152, 0.5);
      }

      .profile-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
        margin-bottom: 40px;
      }

      .profile-left {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 25px;
      }

      .profile-avatar-container {
        position: relative;
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      .profile-avatar-container:hover {
        transform: scale(1.05);
      }

      .profile-avatar-container::after {
        content: "‚úé";
        position: absolute;
        bottom: 10px;
        right: 10px;
        width: 40px;
        height: 40px;
        background: var(--accent);
        color: var(--base03);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2em;
        font-weight: 700;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .profile-avatar-container:hover::after {
        opacity: 1;
      }

      .profile-avatar {
        width: 240px;
        height: 240px;
        border-radius: 50%;
        object-fit: cover;
        border: 5px solid var(--accent);
        background: var(--base01);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        transition: all 0.3s ease;
      }

      .profile-avatar-editable {
        position: absolute;
        inset: 0;
        border-radius: 50%;
        background: rgba(181, 137, 0, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5em;
        font-weight: 600;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .profile-avatar-container:hover .profile-avatar-editable {
        opacity: 1;
      }

      .profile-rank-container {
        text-align: center;
        background: var(--rank-bg);
        padding: 15px 30px;
        border-radius: 10px;
        border: 2px solid var(--accent);
        width: 100%;
        box-shadow: 0 4px 15px rgba(181, 137, 0, 0.2);
      }

      .profile-rank-title {
        font-size: 1.1em;
        font-weight: 600;
        color: var(--yellow);
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .profile-rank-badge {
        font-size: 2.5em;
        line-height: 1.4;
        font-weight: 900;
        color: var(--accent);
        white-space: pre-line;
        text-align: center;
      }

      .profile-info {
        display: flex;
        flex-direction: column;
        gap: 25px;
        width: 100%;
      }

      .info-group {
        margin-bottom: 20px;
      }

      .info-label {
        display: block;
        margin-bottom: 10px;
        font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 1px;
        font-size: 0.95em;
      }

      .info-input {
        width: 100%;
        padding: 14px 18px;
        background: var(--skill-bg);
        border: 2px solid var(--border);
        border-radius: 10px;
        color: var(--text);
        font-size: 1.2em;
        transition: all 0.3s ease;
      }

      .info-input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 15px rgba(181, 137, 0, 0.4);
      }

      .info-select {
        width: 100%;
        padding: 14px 18px;
        background: var(--skill-bg);
        border: 2px solid var(--border);
        border-radius: 10px;
        color: var(--text);
        font-size: 1.2em;
        appearance: none;
        background-image: url("image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23839496' d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 15px center;
        background-size: 20px;
      }

      .profile-description {
        background: var(--skill-bg);
        border: 2px solid var(--border);
        border-radius: 10px;
        padding: 20px;
        width: 100%;
        height: 100%;
        min-height: 500px;
        font-size: 1.1em;
        line-height: 1.7;
        resize: vertical;
        color: var(--text);
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
      }

      .profile-description:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 15px rgba(181, 137, 0, 0.4);
      }

      .level-info {
        background: var(--skill-bg);
        border: 2px solid var(--border);
        border-radius: 10px;
        padding: 20px;
        text-align: center;
      }

      .level-label {
        display: block;
        font-size: 0.95em;
        color: var(--text-muted);
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .level-value {
        font-size: 3.5em;
        font-weight: 900;
        color: var(--text);
        text-shadow: 0 0 15px rgba(181, 137, 0, 0.5);
      }

      .skills-container {
        margin-top: 20px;
        grid-column: 1 / -1;
      }

      .skills-header {
        font-size: 2em;
        font-weight: 700;
        margin-bottom: 25px;
        color: var(--accent);
        text-align: center;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--border);
      }

      .skills-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
        gap: 20px;
      }

      .skill-item {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        background: var(--skill-bg);
        padding: 20px;
        border-radius: 10px;
        border: 1px solid var(--border);
        transition: all 0.3s ease;
      }

      .skill-item:hover {
        background: var(--skill-hover);
        transform: translateX(5px);
        border-color: var(--accent);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .skill-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border);
      }

      .skill-name {
        font-weight: 700;
        font-size: 1.15em;
        color: var(--text);
      }

      .skill-level {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .level-btn {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, var(--accent), var(--yellow));
        color: var(--base03);
        border: none;
        border-radius: 50%;
        font-size: 1.4em;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 3px 10px rgba(181, 137, 0, 0.3);
      }

      .level-btn:hover {
        background: linear-gradient(135deg, var(--yellow), #d7af00);
        transform: scale(1.15);
        box-shadow: 0 5px 15px rgba(181, 137, 0, 0.5);
      }

      .level-btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        background: var(--base01);
        color: var(--base00);
        box-shadow: none;
      }

      .current-level {
        font-size: 1.8em;
        font-weight: 900;
        min-width: 50px;
        text-align: center;
        color: var(--accent);
      }

      .skill-description {
        flex-grow: 1;
        font-size: 0.95em;
        color: var(--text-muted);
        line-height: 1.6;
        margin-top: 12px;
        font-style: italic;
      }

      .skill-level-desc {
        margin-top: 12px;
        padding: 10px 14px;
        background: rgba(181, 137, 0, 0.08);
        border-left: 4px solid var(--accent);
        border-radius: 6px;
        font-size: 0.95em;
        line-height: 1.5;
        color: var(--text);
        white-space: pre-line;
      }

      .skill-progress {
        margin-top: 10px;
        background: var(--base01);
        border-radius: 5px;
        height: 10px;
        overflow: hidden;
      }

      .skill-progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--accent), var(--yellow));
        transition: width 0.3s ease;
      }

      .skill-progress-label {
        font-size: 0.8em;
        color: var(--text-muted);
        text-align: right;
        margin-top: 5px;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background: var(--secondary);
        padding: 45px;
        border-radius: 20px;
        border: 3px solid var(--accent);
        max-width: 550px;
        width: 90%;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.7);
      }

      .modal-title {
        font-size: 2em;
        margin-bottom: 25px;
        color: var(--accent);
        text-align: center;
        text-shadow: 0 0 10px rgba(181, 137, 0, 0.3);
      }

      .modal-input {
        width: 100%;
        padding: 14px 18px;
        margin-bottom: 25px;
        background: var(--skill-bg);
        border: 2px solid var(--border);
        border-radius: 10px;
        color: var(--text);
        font-size: 1.2em;
        transition: all 0.3s ease;
      }

      .modal-input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 15px rgba(181, 137, 0, 0.4);
      }

      .modal-buttons {
        display: flex;
        gap: 20px;
        justify-content: center;
        margin-top: 25px;
      }

      .modal-btn {
        padding: 14px 35px;
        border: none;
        border-radius: 35px;
        font-weight: 700;
        font-size: 1.1em;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1.5px;
      }

      .modal-confirm {
        background: linear-gradient(135deg, var(--success), var(--green));
        color: white;
        box-shadow: 0 4px 15px rgba(133, 153, 0, 0.4);
      }

      .modal-cancel {
        background: linear-gradient(135deg, var(--danger), #a12a26);
        color: white;
        box-shadow: 0 4px 15px rgba(220, 50, 47, 0.4);
      }

      .modal-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 7px 20px rgba(0, 0, 0, 0.5);
      }

      .empty-state {
        text-align: center;
        padding: 80px 20px;
        color: var(--text-muted);
      }

      .empty-state p {
        font-size: 1.3em;
        margin-top: 20px;
      }

      .file-input {
        display: none;
      }

      .notification {
        position: fixed;
        top: 25px;
        right: 25px;
        padding: 18px 30px;
        background: linear-gradient(135deg, var(--success), var(--green));
        color: white;
        border-radius: 12px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        z-index: 2000;
        transform: translateX(500px);
        transition:
          transform 0.4s ease,
          opacity 0.4s ease;
        font-size: 1.1em;
        font-weight: 600;
        letter-spacing: 0.5px;
      }

      .notification.show {
        transform: translateX(0);
      }

      .notification.error {
        background: linear-gradient(135deg, var(--danger), #a12a26);
      }

      @media (max-width: 1024px) {
        .profile-content {
          grid-template-columns: 1fr;
        }

        .skills-grid {
          grid-template-columns: 1fr;
        }

        .profile-avatar {
          width: 200px;
          height: 200px;
        }
      }

      @media (max-width: 768px) {
        .header-title {
          font-size: 1.6em;
        }

        .balance-value {
          font-size: 1.8em;
        }

        .header {
          padding: 15px 20px;
          flex-direction: column;
          gap: 15px;
        }

        .header-controls {
          width: 100%;
          justify-content: space-between;
        }

        .agents-table {
          font-size: 0.85em;
        }

        .agents-table th,
        .agents-table td {
          padding: 8px 10px;
        }

        .agent-avatar {
          width: 30px;
          height: 30px;
        }

        .profile-container {
          padding: 25px;
          margin: 20px;
        }

        .profile-avatar {
          width: 160px;
          height: 160px;
        }

        .profile-rank-badge {
          font-size: 1.8em;
        }

        .level-value {
          font-size: 2.8em;
        }

        .skills-grid {
          grid-template-columns: 1fr;
        }

        .header-icon {
          width: 40px;
          height: 40px;
          font-size: 1.1em;
        }

        .back-btn,
        .delete-btn {
          padding: 10px 20px;
          font-size: 1em;
        }

        .profile-description {
          min-height: 300px;
        }
      }

      /* –í–∫–ª–∞–¥–∫–∏ */
      #tabs-container {
        display: flex;
        justify-content: center;
        gap: 16px;
        margin: 0 auto 30px;
        max-width: 1400px;
        padding: 0 20px;
        flex-wrap: wrap;
      }

      .tab {
        padding: 12px 28px;
        font-size: 1.05em;
        font-weight: 600;
        color: var(--text);
        background: var(--secondary);
        border: 2px solid var(--border);
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.25s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
      }

      .tab:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 18px rgba(181, 137, 0, 0.35);
        border-color: var(--accent);
      }

      .tab.active {
        background: linear-gradient(135deg, var(--accent), var(--yellow));
        color: var(--base03);
        border-color: var(--yellow);
        box-shadow: 0 5px 20px rgba(181, 137, 0, 0.5);
        transform: translateY(-1px);
      }
    </style>
  </head>
  <body>
    <div class="header" id="header">
      <div class="header-title">–ö–ª–∞–Ω –ë–æ–ª—å—à–æ–π –¢–µ–Ω–∏</div>
      <div class="header-controls">
        <div class="balance-container" id="balanceContainer">
          <span class="balance-value" id="totalBalance">0</span>
        </div>
        <a
          href="#"
          class="header-icon export"
          id="exportBtn"
          title="–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö"
        >
          <i class="fas fa-file-export"></i>
        </a>
        <a
          href="#"
          class="header-icon import"
          id="importBtn"
          title="–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö"
        >
          <i class="fas fa-file-import"></i>
        </a>
      </div>
    </div>

    <div class="container">
      <div id="main-view">
        <table class="agents-table" id="agentsTable">
          <thead>
            <tr>
              <th>–ê–≥–µ–Ω—Ç</th>
              <th>–ó–≤–∞–Ω–∏–µ</th>
              <th>–£—Ä–æ–≤–µ–Ω—å</th>
              <th>–°—Ç–∞—Ç—É—Å</th>
            </tr>
          </thead>
          <tbody id="agentsBody">
            <!-- Agents will be populated here -->
          </tbody>
        </table>

        <button class="add-agent-btn" id="addAgentBtn">+</button>
      </div>

      <div id="profile-view" class="profile-container">
        <div class="profile-header">
          <div>
            <h2 class="profile-title" id="profileName">–ò–º—è –∞–≥–µ–Ω—Ç–∞</h2>
            <button class="back-btn" id="backBtn">‚Üê –ù–∞–∑–∞–¥</button>
          </div>
          <div style="display: flex; gap: 15px">
            <button class="copy-btn" id="copyBtn" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ">
              <i class="fas fa-copy"></i>
            </button>
            <button
              class="copy-btn"
              id="deleteAgentBtn"
              title="–£–¥–∞–ª–∏—Ç—å –∞–≥–µ–Ω—Ç–∞"
              style="
                background: linear-gradient(135deg, var(--danger), #a12a26);
                border-color: var(--danger);
              "
            >
              <i class="fas fa-trash-alt"></i>
            </button>
          </div>
        </div>

        <div class="profile-content">
          <div class="profile-left">
            <div class="profile-avatar-container" id="avatarContainer">
              <img
                src=""
                alt="–ê–≥–µ–Ω—Ç"
                class="profile-avatar"
                id="profileAvatar"
              />
              <div class="profile-avatar-editable"></div>
            </div>

            <div class="profile-rank-container">
              <div class="profile-rank-title" id="agentRankTitle">–ó–≤–∞–Ω–∏–µ</div>
              <div class="profile-rank-badge" id="agentRankBadge">‚óΩÔ∏è</div>
            </div>

            <div class="profile-info">
              <div class="info-group">
                <label class="info-label">–ò–º—è –∞–≥–µ–Ω—Ç–∞</label>
                <input
                  type="text"
                  class="info-input"
                  id="agentName"
                  placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è"
                />
              </div>

              <div class="info-group">
                <label class="info-label">–°—Ç–∞—Ç—É—Å</label>
                <select class="info-select" id="agentStatus">
                  <option value="waiting">–û–∂–∏–¥–∞–Ω–∏–µ</option>
                  <option value="active">–í—ã–ø–æ–ª–Ω—è–µ—Ç –º–∏—Å—Å–∏—é</option>
                </select>
              </div>

              <div class="level-info">
                <span class="level-label">–£–†–û–í–ï–ù–¨</span>
                <div class="level-value" id="agentLevel">0</div>
              </div>
            </div>
          </div>

          <div class="profile-right">
            <div class="info-group" style="width: 100%; height: 100%">
              <label class="info-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
              <textarea
                class="profile-description"
                id="agentDescription"
                placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞"
              ></textarea>
            </div>
          </div>
        </div>

        <div class="skills-container">
          <div class="skills-header">–ù–∞–≤—ã–∫–∏ –∞–≥–µ–Ω—Ç–∞</div>
          <div class="skills-grid" id="skillsGrid">
            <!-- Skills will be populated here -->
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="addAgentModal">
      <div class="modal-content">
        <h3 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞</h3>
        <input
          type="text"
          class="modal-input"
          id="newAgentName"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∞–≥–µ–Ω—Ç–∞"
          required
        />
        <input
          type="text"
          class="modal-input"
          id="newAgentPhoto"
          placeholder="URL —Ñ–æ—Ç–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
        />
        <textarea
          class="modal-input"
          id="newAgentDescription"
          placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
          rows="4"
        ></textarea>
        <div class="modal-buttons">
          <button class="modal-btn modal-confirm" id="confirmAddAgent">
            –î–æ–±–∞–≤–∏—Ç—å
          </button>
          <button class="modal-btn modal-cancel" id="cancelAddAgent">
            –û—Ç–º–µ–Ω–∞
          </button>
        </div>
      </div>
    </div>

    <div class="modal" id="editBalanceModal">
      <div class="modal-content">
        <h3 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—â–∏–π –±–∞–ª–∞–Ω—Å</h3>
        <p
          style="
            text-align: center;
            margin-bottom: 20px;
            color: var(--text);
            font-size: 1.1em;
          "
        >
          –í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞:<br />
          <small style="color: var(--text-muted); font-size: 0.95em">
            –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ ‚Äî –¥–æ–±–∞–≤–∏—Ç—å, –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ ‚Äî –≤—ã—á–µ—Å—Ç—å
          </small>
        </p>
        <input
          type="number"
          class="modal-input"
          id="balanceChangeValue"
          placeholder="0"
          step="1"
        />
        <div class="modal-buttons">
          <button class="modal-btn modal-confirm" id="confirmBalanceEdit">
            –ü—Ä–∏–º–µ–Ω–∏—Ç—å
          </button>
          <button class="modal-btn modal-cancel" id="cancelBalanceEdit">
            –û—Ç–º–µ–Ω–∞
          </button>
        </div>
      </div>
    </div>

    <div class="modal" id="deleteAgentModal">
      <div class="modal-content">
        <h3 class="modal-title">–£–¥–∞–ª–∏—Ç—å –∞–≥–µ–Ω—Ç–∞?</h3>
        <p>–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ <strong>–Ω–∞–≤—Å–µ–≥–¥–∞</strong> —É–¥–∞–ª–∏—Ç—å:</p>
        <p
          style="
            font-size: 1.4em;
            font-weight: bold;
            color: var(--danger);
            text-align: center;
            margin: 20px 0;
          "
          id="deleteAgentNameDisplay"
        ></p>
        <p style="text-align: center; color: var(--text-muted)">
          –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.
        </p>
        <div class="modal-buttons">
          <button class="modal-btn modal-confirm" id="confirmDeleteAgent">
            –£–¥–∞–ª–∏—Ç—å
          </button>
          <button class="modal-btn modal-cancel" id="cancelDeleteAgent">
            –û—Ç–º–µ–Ω–∞
          </button>
        </div>
      </div>
    </div>

    <div class="notification" id="notification"></div>

    <input type="file" id="fileInput" class="file-input" accept=".json" />

    <script>
      // ==================== –î–ê–ù–ù–´–ï ====================

      const GAME_DATA = [
        {
          tabName: "–ê–≥–µ–Ω—Ç—ã",
          skills: [
            {
              id: "infiltration",
              name: "–í–Ω–µ–¥—Ä–µ–Ω–∏–µ",
              description:
                "–ò—Å–∫—É—Å—Å—Ç–≤–æ –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏, –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏, —É–±–µ–∂–¥–µ–Ω–∏—è, –ª–∂–∏, –∏–º–ø—Ä–æ–≤–∏–∑–∞—Ü–∏–∏, —É—Ö–æ–¥–∞ –æ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –∑–∞–ø—É–≥–∏–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –≤ –ª—é–±—ã–µ –∫—Ä—É–≥–∏.",
            },
          ],
          ranks: [
            { minLevel: 0, maxLevel: 2, name: "–†–µ–∫—Ä—É—Ç", badge: "‚óΩÔ∏è" },
            { minLevel: 3, maxLevel: 4, name: "–°–ª—É–≥–∞", badge: "‚¨úÔ∏è‚¨úÔ∏è" },
            { minLevel: 5, maxLevel: 6, name: "–£—á–µ–Ω–∏–∫", badge: "‚¨úÔ∏è‚¨úÔ∏è‚¨úÔ∏è" },
            { minLevel: 7, maxLevel: 8, name: "–ü–æ—Å–≤—è—â—ë–Ω–Ω—ã–π", badge: "üü®" },
            { minLevel: 9, maxLevel: 10, name: "–û—Ö–æ—Ç–Ω–∏–∫", badge: "üü®üü®" },
          ],
          skillLevelDescriptions: {
            infiltration: {
              1: "–ë–∞–∑–æ–≤—ã–µ –Ω–∞–≤—ã–∫–∏ –æ–±—â–µ–Ω–∏—è –∏ –ø—Ä–æ—Å—Ç–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞. –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –æ–¥–µ–∂–¥—É –∏ –ø–æ—Ö–æ–¥–∫—É, –ø—Ä–∏—Ç–≤–æ—Ä–∏—Ç—å—Å—è –æ–±—ã—á–Ω—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º –≤ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏. –í–ª–∞–¥–µ–µ—Ç 1‚Äì2 —è–∑—ã–∫–∞–º–∏ –Ω–∞ –±–∞–∑–æ–≤–æ–º —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω–æ–º —É—Ä–æ–≤–Ω–µ.",
              2: "–£–≤–µ—Ä–µ–Ω–Ω–æ–µ –≤—Ç–∏—Ä–∞–Ω–∏–µ –≤ –¥–æ–≤–µ—Ä–∏–µ. –ú–µ–Ω—è–µ—Ç –º–∞–Ω–µ—Ä—ã, –∞–∫—Ü–µ–Ω—Ç –∏ –±–∞–∑–æ–≤—ã–π –≥—Ä–∏–º. –õ—ë–≥–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≥–æ–ª–æ—Å–∞. –ú–æ–∂–µ—Ç –∫–∞–∑–∞—Ç—å—Å—è –Ω–∞ 3‚Äì5 –ª–µ—Ç —Å—Ç–∞—Ä—à–µ/–º–æ–ª–æ–∂–µ. 2‚Äì3 —è–∑—ã–∫–∞, –≤–∫–ª—é—á–∞—è –∞–∫—Ü–µ–Ω—Ç—ã.",
              3: "–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –≥—Ä–∏–º –∏ –º–∞—Å–∫–∏, —Å–º–µ–Ω–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞ ¬±10 –ª–µ—Ç. –£–±–µ–¥–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω—è–µ—Ç –≥–æ–ª–æ—Å (–º—É–∂—Å–∫–æ–π ‚Üî –∂–µ–Ω—Å–∫–∏–π –Ω–∞ –±–∞–∑–æ–≤–æ–º —É—Ä–æ–≤–Ω–µ). –ü—Ä–æ–Ω–∏–∫–∞–µ—Ç –≤ –≥—Ä—É–ø–ø—ã –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π. 3‚Äì4 —è–∑—ã–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –Ω–æ—Å–∏—Ç–µ–ª—è.",
              4: "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–∞—Å–∫–∏ –∏ –ø—Ä–æ—Ç–µ–∑—ã –ª–∏—Ü–∞. –ü–æ–ª–Ω–∞—è —Å–º–µ–Ω–∞ –≥–æ–ª–æ—Å–∞. –í–æ–∑—Ä–∞—Å—Ç ¬±15 –ª–µ—Ç, —á–∞—Å—Ç–∏—á–Ω–∞—è –∞–Ω–¥—Ä–æ–≥–∏–Ω–Ω–æ—Å—Ç—å. –õ–µ–≥–µ–Ω–¥–∞ –¥–µ—Ä–∂–∏—Ç—Å—è –Ω–µ–¥–µ–ª–∏. 4‚Äì5 —è–∑—ã–∫–æ–≤, –ª—é–±–æ–π –∞–∫—Ü–µ–Ω—Ç –∏ —Å–ª–µ–Ω–≥.",
              5: "–ì–æ–ª–æ—Å –º–µ–Ω—è–µ—Ç—Å—è –∏–¥–µ–∞–ª—å–Ω–æ –±–µ–∑ —Ç–µ—Ö–Ω–∏–∫–∏. –í–æ–∑—Ä–∞—Å—Ç ¬±20 –ª–µ—Ç. –í–Ω–µ–¥—Ä—è–µ—Ç—Å—è –≤ –∑–∞–∫—Ä—ã—Ç—ã–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ –Ω–∞ –º–µ—Å—è—Ü—ã. 5+ —è–∑—ã–∫–æ–≤ –∏–¥–µ–∞–ª—å–Ω–æ. –ú–∞–Ω–∏–ø—É–ª–∏—Ä—É–µ—Ç —á–µ—Ä–µ–∑ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å.",
              6: "–°–∏–ª–∏–∫–æ–Ω–æ–≤—ã–µ –º–∞—Å–∫–∏ —Ç–µ–ª–∞ (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Å–≤–æ–µ–≥–æ –ø–æ–ª–∞). –ì–æ–ª–æ—Å –Ω–µ–æ—Ç–ª–∏—á–∏–º. –õ–µ–≥–µ–Ω–¥–∞ –Ω–∞ –≥–æ–¥—ã. 6‚Äì8 —è–∑—ã–∫–æ–≤, –≤–∫–ª—é—á–∞—è –º—ë—Ä—Ç–≤—ã–µ –∏ —Ä–µ–¥–∫–∏–µ. –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É –Ω–∏–º–∏.",
              7: "–ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –≤—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –æ—Ö—Ä–∞–Ω–æ–π –∏ –∫–∞–º–µ—Ä–∞–º–∏. –ì–æ–ª–æ—Å –∏ –º–∞–Ω–µ—Ä—ã –∫–æ–ø–∏—Ä—É–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ. 8‚Äì10 —è–∑—ã–∫–æ–≤, –∏–∑–æ–±—Ä–µ—Ç–∞–µ—Ç –¥–∏–∞–ª–µ–∫—Ç—ã –Ω–∞ –ª–µ—Ç—É.",
              8: "–ú–æ–∂–µ—Ç –ø–æ–¥–º–µ–Ω–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ —Ç–æ–≥–æ –∂–µ –ø–æ–ª–∞ –Ω–∞ –¥–ª–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ä–æ–∫. 10‚Äì12 —è–∑—ã–∫–æ–≤ –Ω–∞ —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–º —É—Ä–æ–≤–Ω–µ.",
              9: "–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–∏—á–Ω–æ—Å—Ç–µ–π (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ø–æ–ª–∞). 12‚Äì15 —è–∑—ã–∫–æ–≤, —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–µ –¥–∏–∞–ª–µ–∫—Ç—ã –∏ —è–∑—ã–∫–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã.",
              10: "–ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–æ–≤–æ–π —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ø–æ–ª–∞). –ë–∏–æ–º–µ—Ç—Ä–∏—è –º–µ–Ω—è–µ—Ç—Å—è –∏–¥–µ–∞–ª—å–Ω–æ. –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —è–∑—ã–∫–∏ –º–∏—Ä–∞ (15+), –≤–∫–ª—é—á–∞—è –¥—Ä–µ–≤–Ω–∏–µ –∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ.",
            },
          },
          maxLevel: 10,
          costBase: 1,
        },

        {
          tabName: "–¢–µ–Ω—å –ú–∞—à–∏–Ω—ã",
          skills: [
            {
              id: "infiltration",
              name: "–í–Ω–µ–¥—Ä–µ–Ω–∏–µ",
              description:
                "–ò—Å–∫—É—Å—Å—Ç–≤–æ –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏, –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏, —É–±–µ–∂–¥–µ–Ω–∏—è, –ª–∂–∏, –∏–º–ø—Ä–æ–≤–∏–∑–∞—Ü–∏–∏, —É—Ö–æ–¥–∞ –æ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –∑–∞–ø—É–≥–∏–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –≤ –ª—é–±—ã–µ –∫—Ä—É–≥–∏.",
            },
          ],
          ranks: [
            { minLevel: 0, maxLevel: 3, name: "–†–µ–∫—Ä—É—Ç", badge: "‚óΩÔ∏è" },
            { minLevel: 4, maxLevel: 6, name: "–°–ª—É–≥–∞", badge: "‚¨úÔ∏è‚¨úÔ∏è" },
            { minLevel: 7, maxLevel: 9, name: "–£—á–µ–Ω–∏–∫", badge: "‚¨úÔ∏è‚¨úÔ∏è‚¨úÔ∏è" },
            { minLevel: 10, maxLevel: 12, name: "–ü–æ—Å–≤—è—â—ë–Ω–Ω—ã–π", badge: "üü®" },
            { minLevel: 13, maxLevel: 15, name: "–û—Ö–æ—Ç–Ω–∏–∫", badge: "üü®üü®" },
          ],
          skillLevelDescriptions: {
            infiltration: {
              1: "–ë–∞–∑–æ–≤—ã–µ –Ω–∞–≤—ã–∫–∏ –æ–±—â–µ–Ω–∏—è –∏ –ø—Ä–æ—Å—Ç–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞. –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –æ–¥–µ–∂–¥—É –∏ –ø–æ—Ö–æ–¥–∫—É, –ø—Ä–∏—Ç–≤–æ—Ä–∏—Ç—å—Å—è –æ–±—ã—á–Ω—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º –≤ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏. –í–ª–∞–¥–µ–µ—Ç 1‚Äì2 —è–∑—ã–∫–∞–º–∏ –Ω–∞ –±–∞–∑–æ–≤–æ–º —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω–æ–º —É—Ä–æ–≤–Ω–µ.",
              2: "–£–≤–µ—Ä–µ–Ω–Ω–æ–µ –≤—Ç–∏—Ä–∞–Ω–∏–µ –≤ –¥–æ–≤–µ—Ä–∏–µ. –ú–µ–Ω—è–µ—Ç –º–∞–Ω–µ—Ä—ã, –∞–∫—Ü–µ–Ω—Ç –∏ –±–∞–∑–æ–≤—ã–π –≥—Ä–∏–º. –õ—ë–≥–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≥–æ–ª–æ—Å–∞. –ú–æ–∂–µ—Ç –∫–∞–∑–∞—Ç—å—Å—è –Ω–∞ 3‚Äì5 –ª–µ—Ç —Å—Ç–∞—Ä—à–µ/–º–æ–ª–æ–∂–µ. 2‚Äì3 —è–∑—ã–∫–∞, –≤–∫–ª—é—á–∞—è –∞–∫—Ü–µ–Ω—Ç—ã.",
              3: "–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –≥—Ä–∏–º –∏ –º–∞—Å–∫–∏, —Å–º–µ–Ω–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞ ¬±10 –ª–µ—Ç. –£–±–µ–¥–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω—è–µ—Ç –≥–æ–ª–æ—Å (–º—É–∂—Å–∫–æ–π ‚Üî –∂–µ–Ω—Å–∫–∏–π –Ω–∞ –±–∞–∑–æ–≤–æ–º —É—Ä–æ–≤–Ω–µ). –ü—Ä–æ–Ω–∏–∫–∞–µ—Ç –≤ –≥—Ä—É–ø–ø—ã –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π. 3‚Äì4 —è–∑—ã–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –Ω–æ—Å–∏—Ç–µ–ª—è.",
              4: "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–∞—Å–∫–∏ –∏ –ø—Ä–æ—Ç–µ–∑—ã –ª–∏—Ü–∞. –ü–æ–ª–Ω–∞—è —Å–º–µ–Ω–∞ –≥–æ–ª–æ—Å–∞. –í–æ–∑—Ä–∞—Å—Ç ¬±15 –ª–µ—Ç, —á–∞—Å—Ç–∏—á–Ω–∞—è –∞–Ω–¥—Ä–æ–≥–∏–Ω–Ω–æ—Å—Ç—å. –õ–µ–≥–µ–Ω–¥–∞ –¥–µ—Ä–∂–∏—Ç—Å—è –Ω–µ–¥–µ–ª–∏. 4‚Äì5 —è–∑—ã–∫–æ–≤, –ª—é–±–æ–π –∞–∫—Ü–µ–Ω—Ç –∏ —Å–ª–µ–Ω–≥.",
              5: "–ì–æ–ª–æ—Å –º–µ–Ω—è–µ—Ç—Å—è –∏–¥–µ–∞–ª—å–Ω–æ –±–µ–∑ —Ç–µ—Ö–Ω–∏–∫–∏. –í–æ–∑—Ä–∞—Å—Ç ¬±20 –ª–µ—Ç. –í–Ω–µ–¥—Ä—è–µ—Ç—Å—è –≤ –∑–∞–∫—Ä—ã—Ç—ã–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ –Ω–∞ –º–µ—Å—è—Ü—ã. 5+ —è–∑—ã–∫–æ–≤ –∏–¥–µ–∞–ª—å–Ω–æ. –ú–∞–Ω–∏–ø—É–ª–∏—Ä—É–µ—Ç —á–µ—Ä–µ–∑ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å.",
              6: "–°–∏–ª–∏–∫–æ–Ω–æ–≤—ã–µ –º–∞—Å–∫–∏ —Ç–µ–ª–∞ (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Å–≤–æ–µ–≥–æ –ø–æ–ª–∞). –ì–æ–ª–æ—Å –Ω–µ–æ—Ç–ª–∏—á–∏–º. –õ–µ–≥–µ–Ω–¥–∞ –Ω–∞ –≥–æ–¥—ã. 6‚Äì8 —è–∑—ã–∫–æ–≤, –≤–∫–ª—é—á–∞—è –º—ë—Ä—Ç–≤—ã–µ –∏ —Ä–µ–¥–∫–∏–µ. –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É –Ω–∏–º–∏.",
              7: "–ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –≤—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –æ—Ö—Ä–∞–Ω–æ–π –∏ –∫–∞–º–µ—Ä–∞–º–∏. –ì–æ–ª–æ—Å –∏ –º–∞–Ω–µ—Ä—ã –∫–æ–ø–∏—Ä—É–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ. 8‚Äì10 —è–∑—ã–∫–æ–≤, –∏–∑–æ–±—Ä–µ—Ç–∞–µ—Ç –¥–∏–∞–ª–µ–∫—Ç—ã –Ω–∞ –ª–µ—Ç—É.",
              8: "–ú–æ–∂–µ—Ç –ø–æ–¥–º–µ–Ω–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ —Ç–æ–≥–æ –∂–µ –ø–æ–ª–∞ –Ω–∞ –¥–ª–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ä–æ–∫. 10‚Äì12 —è–∑—ã–∫–æ–≤ –Ω–∞ —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–º —É—Ä–æ–≤–Ω–µ.",
              9: "–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–∏—á–Ω–æ—Å—Ç–µ–π (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ø–æ–ª–∞). 12‚Äì15 —è–∑—ã–∫–æ–≤, —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–µ –¥–∏–∞–ª–µ–∫—Ç—ã –∏ —è–∑—ã–∫–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã.",
              10: "–ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–æ–≤–æ–π —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ø–æ–ª–∞). –ë–∏–æ–º–µ—Ç—Ä–∏—è –º–µ–Ω—è–µ—Ç—Å—è –∏–¥–µ–∞–ª—å–Ω–æ. –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —è–∑—ã–∫–∏ –º–∏—Ä–∞ (15+), –≤–∫–ª—é—á–∞—è –¥—Ä–µ–≤–Ω–∏–µ –∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ.",
              11: "–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —É—Ä–æ–≤–Ω—è 11 ‚Äî –ª–µ–≥–µ–Ω–¥–∞ –¥–µ—Ä–∂–∏—Ç—Å—è –¥–µ—Å—è—Ç–∏–ª–µ—Ç–∏—è–º–∏.",
              12: "–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —É—Ä–æ–≤–Ω—è 12 ‚Äî –±–∏–æ–º–µ—Ç—Ä–∏—è –∏ –î–ù–ö-–ø–æ–¥–æ–±–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã –ø–æ–¥–¥–µ–ª—ã–≤–∞—é—Ç—Å—è.",
              13: "–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —É—Ä–æ–≤–Ω—è 13 ‚Äî –º–æ–∂–µ—Ç –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.",
              14: "–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —É—Ä–æ–≤–Ω—è 14 ‚Äî –ø–æ—á—Ç–∏ –ø–æ–ª–Ω–æ–µ —Å–ª–∏—è–Ω–∏–µ —Å –Ω–æ–≤–æ–π –ª–∏—á–Ω–æ—Å—Ç—å—é.",
              15: "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —É—Ä–æ–≤–Ω—è 15 ‚Äî –∞–≥–µ–Ω—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ—Ä–∞–∑–ª–∏—á–∏–º –¥–∞–∂–µ –¥–ª—è —Å–∞–º—ã—Ö –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö —Å–∏—Å—Ç–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.",
            },
          },
          maxLevel: 15,
          costBase: 2,
        },
      ];

      // ==================== DOM ====================

      const agentsBody = document.getElementById("agentsBody");
      const addAgentBtn = document.getElementById("addAgentBtn");
      const addAgentModal = document.getElementById("addAgentModal");
      const confirmAddAgent = document.getElementById("confirmAddAgent");
      const cancelAddAgent = document.getElementById("cancelAddAgent");
      const newAgentName = document.getElementById("newAgentName");
      const newAgentPhoto = document.getElementById("newAgentPhoto");
      const newAgentDescription = document.getElementById(
        "newAgentDescription",
      );
      const profileView = document.getElementById("profile-view");
      const mainView = document.getElementById("main-view");
      const backBtn = document.getElementById("backBtn");
      const agentNameInput = document.getElementById("agentName");
      const agentDescriptionInput = document.getElementById("agentDescription");
      const agentStatusSelect = document.getElementById("agentStatus");
      const agentRankTitle = document.getElementById("agentRankTitle");
      const agentRankBadge = document.getElementById("agentRankBadge");
      const agentLevelDisplay = document.getElementById("agentLevel");
      const skillsGrid = document.getElementById("skillsGrid");
      const totalBalanceDisplay = document.getElementById("totalBalance");
      const balanceContainer = document.getElementById("balanceContainer");
      const exportBtn = document.getElementById("exportBtn");
      const importBtn = document.getElementById("importBtn");
      const fileInput = document.getElementById("fileInput");
      const editBalanceModal = document.getElementById("editBalanceModal");
      const balanceChangeValue = document.getElementById("balanceChangeValue");
      const confirmBalanceEdit = document.getElementById("confirmBalanceEdit");
      const cancelBalanceEdit = document.getElementById("cancelBalanceEdit");
      const header = document.getElementById("header");
      const copyBtn = document.getElementById("copyBtn");
      const profileAvatar = document.getElementById("profileAvatar");
      const profileName = document.getElementById("profileName");
      const avatarContainer = document.getElementById("avatarContainer");
      const notification = document.getElementById("notification");
      const deleteAgentModal = document.getElementById("deleteAgentModal");
      const confirmDeleteAgent = document.getElementById("confirmDeleteAgent");
      const cancelDeleteAgent = document.getElementById("cancelDeleteAgent");
      const deleteAgentNameDisplay = document.getElementById(
        "deleteAgentNameDisplay",
      );
      const deleteAgentBtn = document.getElementById("deleteAgentBtn");

      let currentAgentId = null;
      let currentAgentData = null;
      let isAutoSaving = false;
      let holdInterval = null;
      let agentToDeleteId = null;
      let currentTab = 0; // ‚Üê —Ç–µ–∫—É—â–∞—è –≤–∫–ª–∞–¥–∫–∞

      // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Ç—å –≤–∫–ª–∞–¥–∫–∏
      const tabsContainer = document.createElement("div");
      tabsContainer.id = "tabs-container";

      GAME_DATA.forEach((tabConfig, index) => {
        const tabBtn = document.createElement("button");
        tabBtn.className = "tab" + (index === currentTab ? " active" : "");
        tabBtn.textContent = tabConfig.tabName || `–í–∫–ª–∞–¥–∫–∞ ${index + 1}`;

        tabBtn.addEventListener("click", () => {
          // —Å–Ω–∏–º–∞–µ–º active —Å–æ –≤—Å–µ—Ö
          document
            .querySelectorAll(".tab")
            .forEach((btn) => btn.classList.remove("active"));
          // —Å—Ç–∞–≤–∏–º active –Ω–∞ —Ç–µ–∫—É—â—É—é
          tabBtn.classList.add("active");

          switchTab(index);
        });

        tabsContainer.appendChild(tabBtn);
      });

      document
        .querySelector(".container")
        .insertBefore(tabsContainer, mainView);
      // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================

      loadAgents();
      loadTotalBalance();
      setupEventListeners();

      function switchTab(tabIndex) {
        currentTab = tabIndex;
        Array.from(tabsContainer.children).forEach((btn, i) => {
          btn.style.background =
            i === tabIndex ? "var(--accent)" : "var(--secondary)";
        });
        if (profileView.style.display === "block") {
          profileView.style.display = "none";
          mainView.style.display = "block";
        }
        loadAgents();
        loadTotalBalance();
      }

      // ==================== –§–£–ù–ö–¶–ò–ò ====================

      function getStorageKey(key) {
        return `${key}_${currentTab}`;
      }

      function loadTotalBalance() {
        const balance =
          parseInt(localStorage.getItem(getStorageKey("totalBalance"))) || 0;
        totalBalanceDisplay.textContent = balance;
      }

      function saveBalanceChange() {
        const change = parseInt(balanceChangeValue.value);
        if (isNaN(change)) {
          showNotification("–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ", "error");
          return;
        }
        let balance =
          parseInt(localStorage.getItem(getStorageKey("totalBalance"))) || 0;
        const newBalance = balance + change;
        if (newBalance < 0) {
          showNotification("–ë–∞–ª–∞–Ω—Å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º", "error");
          return;
        }
        localStorage.setItem(getStorageKey("totalBalance"), newBalance);
        loadTotalBalance();
        editBalanceModal.style.display = "none";
        showNotification(`–ë–∞–ª–∞–Ω—Å –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ ${change > 0 ? "+" : ""}${change}`);
      }

      function exportDatabase() {
        const agents =
          JSON.parse(localStorage.getItem(getStorageKey("assassinAgents"))) ||
          [];
        const balance =
          parseInt(localStorage.getItem(getStorageKey("totalBalance"))) || 0;
        const data = {
          agents,
          totalBalance: balance,
          exportedAt: new Date().toISOString(),
          tab: currentTab,
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `clan-big-shadow-tab${currentTab}-${new Date().toISOString().slice(0, 10)}.json`;
        a.click();
        URL.revokeObjectURL(url);
        showNotification("–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã");
      }

      function importDatabase(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
          try {
            const data = JSON.parse(ev.target.result);
            if (data.agents && data.totalBalance !== undefined) {
              localStorage.setItem(
                getStorageKey("assassinAgents"),
                JSON.stringify(data.agents),
              );
              localStorage.setItem(
                getStorageKey("totalBalance"),
                data.totalBalance,
              );
              showNotification("–î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã");
              loadTotalBalance();
              loadAgents();
            } else {
              showNotification("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞", "error");
            }
          } catch (err) {
            showNotification("–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞: " + err.message, "error");
          }
        };
        reader.readAsText(file);
        fileInput.value = "";
      }

      function loadAgents() {
        const agents =
          JSON.parse(localStorage.getItem(getStorageKey("assassinAgents"))) ||
          [];
        agentsBody.innerHTML = "";

        if (agents.length === 0) {
          agentsBody.innerHTML = `<tr><td colspan="4" class="empty-state"><p>–ù–µ—Ç –∞–≥–µ–Ω—Ç–æ–≤</p><p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞</p></td></tr>`;
          return;
        }

        agents.sort((a, b) => b.level - a.level);

        agents.forEach((agent) => {
          const photo =
            agent.photo ||
            "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8BQDwAEhQGAhKmMIQAAAABJRU5ErkJggg==";
          const statusClass = agent.status || "waiting";
          const config = GAME_DATA[currentTab];
          const rank = config.ranks.find((r) => agent.rank === r.name) || {
            badge: "‚óΩÔ∏è",
          };

          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>
                <img src="${photo}" class="agent-avatar" alt="${agent.name}"
                     onerror="this.src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8BQDwAEhQGAhKmMIQAAAABJRU5ErkJggg=='">
                <span>${agent.name}</span>
            </td>
            <td><div class="rank"><div class="rank-name">${agent.rank}</div><div class="rank-badge">${rank.badge}</div></div></td>
            <td>${agent.level}</td>
            <td><span class="status ${statusClass}">${statusClass === "waiting" ? "–û–∂–∏–¥–∞–Ω–∏–µ" : "–í—ã–ø–æ–ª–Ω—è–µ—Ç –º–∏—Å—Å–∏—é"}</span></td>
        `;
          tr.addEventListener("click", () => openAgentProfile(agent.id));
          agentsBody.appendChild(tr);
        });
      }

      function addNewAgent() {
        const name = newAgentName.value.trim();
        if (!name) {
          showNotification("–í–≤–µ–¥–∏—Ç–µ –∏–º—è", "error");
          return;
        }

        const config = GAME_DATA[currentTab];
        const agent = {
          id: Date.now().toString(),
          name,
          photo: newAgentPhoto.value.trim() || "",
          description: newAgentDescription.value.trim() || "–ù–æ–≤—ã–π –∞–≥–µ–Ω—Ç –∫–ª–∞–Ω–∞",
          skills: config.skills.reduce((acc, s) => {
            acc[s.id] = 0;
            return acc;
          }, {}),
          level: 0,
          rank: config.ranks[0].name,
          status: "waiting",
          createdAt: new Date().toISOString(),
        };

        const agents =
          JSON.parse(localStorage.getItem(getStorageKey("assassinAgents"))) ||
          [];
        agents.push(agent);
        localStorage.setItem(
          getStorageKey("assassinAgents"),
          JSON.stringify(agents),
        );

        addAgentModal.style.display = "none";
        loadAgents();
        showNotification("–ê–≥–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω");
      }

      function openAgentProfile(id) {
        const agents =
          JSON.parse(localStorage.getItem(getStorageKey("assassinAgents"))) ||
          [];
        const agent = agents.find((a) => a.id === id);
        if (!agent) return;

        currentAgentId = id;
        currentAgentData = { ...agent };

        agentNameInput.value = agent.name;
        agentDescriptionInput.value = agent.description || "";
        agentStatusSelect.value = agent.status || "waiting";
        const config = GAME_DATA[currentTab];
        agentRankTitle.textContent = agent.rank;
        agentRankBadge.textContent =
          config.ranks.find((r) => r.name === agent.rank)?.badge || "‚óΩÔ∏è";
        agentLevelDisplay.textContent = agent.level;
        profileAvatar.src =
          agent.photo ||
          "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8BQDwAEhQGAhKmMIQAAAABJRU5ErkJggg==";
        profileName.textContent = agent.name;

        renderSkills();

        mainView.style.display = "none";
        profileView.style.display = "block";
      }

      function renderSkills() {
        skillsGrid.innerHTML = "";

        const config = GAME_DATA[currentTab];
        config.skills.forEach((skill) => {
          const level = currentAgentData.skills[skill.id] || 0;
          const maxLevel = config.maxLevel;
          const progress = (Math.min(level, maxLevel) / maxLevel) * 100;

          let levelText = "";
          const desc = config.skillLevelDescriptions[skill.id];
          if (desc && level >= 1 && level <= maxLevel) {
            levelText = desc[level] || "";
          }

          const item = document.createElement("div");
          item.className = "skill-item";
          item.innerHTML = `
            <div class="skill-header">
                <span class="skill-name">${skill.name}</span>
                <div class="skill-level">
                    <button class="level-btn ${level < 1 ? "disabled" : ""}" data-skill="${skill.id}" data-action="decrease">-</button>
                    <span class="current-level">${level}</span>
                    <button class="level-btn ${level >= maxLevel ? "disabled" : ""}" data-skill="${skill.id}" data-action="increase">+</button>
                </div>
            </div>
            <div class="skill-description">${skill.description}</div>
            ${levelText ? `<div class="skill-level-desc">${levelText}</div>` : ""}
            <div class="skill-progress">
                <div class="skill-progress-bar" style="width:${progress}%"></div>
            </div>
            <div class="skill-progress-label">${Math.min(level, maxLevel)}/${maxLevel}</div>
        `;
          skillsGrid.appendChild(item);
        });

        document.querySelectorAll(".level-btn").forEach((btn) => {
          btn.addEventListener("click", handleSkillChange);
          btn.addEventListener("mousedown", startHold);
          btn.addEventListener("mouseup", stopHold);
          btn.addEventListener("mouseleave", stopHold);
        });
      }

      function startHold(e) {
        if (e.target.classList.contains("disabled")) return;
        const skill = e.target.dataset.skill;
        const action = e.target.dataset.action;
        changeSkillLevel(skill, action);
        holdInterval = setInterval(() => changeSkillLevel(skill, action), 200);
      }

      function stopHold() {
        clearInterval(holdInterval);
      }

      function changeSkillLevel(skillId, action) {
        let level = currentAgentData.skills[skillId] || 0;
        let balance =
          parseInt(localStorage.getItem(getStorageKey("totalBalance"))) || 0;
        const config = GAME_DATA[currentTab];
        const maxLevel = config.maxLevel;
        const costBase = config.costBase;

        if (action === "increase") {
          if (level >= maxLevel) return;
          const cost = (level + 1) * costBase;
          if (balance < cost) return;
          localStorage.setItem(getStorageKey("totalBalance"), balance - cost);
          currentAgentData.skills[skillId] = level + 1;
        } else if (action === "decrease" && level > 0) {
          const refund = level * costBase;
          localStorage.setItem(getStorageKey("totalBalance"), balance + refund);
          currentAgentData.skills[skillId] = level - 1;
        }

        recalculateAgentStats();
        renderSkills();
        loadTotalBalance();
        autoSaveAgent();
      }

      function handleSkillChange(e) {
        if (e.target.classList.contains("disabled")) return;
        const { skill, action } = e.target.dataset;
        changeSkillLevel(skill, action);
      }

      function recalculateAgentStats() {
        let total = 0;
        Object.values(currentAgentData.skills).forEach((v) => (total += v));
        currentAgentData.level = total;

        const config = GAME_DATA[currentTab];
        const rank = config.ranks.find(
          (r) => total >= r.minLevel && total <= r.maxLevel,
        );
        currentAgentData.rank = rank ? rank.name : config.ranks[0].name;

        agentLevelDisplay.textContent = total;
        agentRankTitle.textContent = currentAgentData.rank;
        agentRankBadge.textContent = rank ? rank.badge : "‚óΩÔ∏è";
      }

      function editAvatar() {
        const url = prompt("URL —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏:", currentAgentData.photo || "");
        if (url !== null) {
          currentAgentData.photo = url.trim();
          profileAvatar.src =
            url.trim() ||
            "https://via.placeholder.com/240/073642/839496?text=???";
          autoSaveAgent();
        }
      }

      function autoSaveAgent() {
        if (isAutoSaving || !currentAgentId) return;
        isAutoSaving = true;

        currentAgentData.name = agentNameInput.value.trim();
        currentAgentData.description = agentDescriptionInput.value.trim();
        currentAgentData.status = agentStatusSelect.value;

        const agents =
          JSON.parse(localStorage.getItem(getStorageKey("assassinAgents"))) ||
          [];
        const idx = agents.findIndex((a) => a.id === currentAgentId);
        if (idx !== -1) {
          agents[idx] = currentAgentData;
          localStorage.setItem(
            getStorageKey("assassinAgents"),
            JSON.stringify(agents),
          );
          profileName.textContent = currentAgentData.name;
        }

        setTimeout(() => (isAutoSaving = false), 400);
      }

      function copyAgentData() {
        const data = {
          name: currentAgentData.name,
          description: currentAgentData.description,
          skills: currentAgentData.skills,
          level: currentAgentData.level,
          rank: currentAgentData.rank,
        };
        navigator.clipboard
          .writeText(JSON.stringify(data, null, 2))
          .then(() => showNotification("–î–∞–Ω–Ω—ã–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã"))
          .catch(() => showNotification("–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è", "error"));
      }

      function showNotification(msg, type = "success") {
        notification.textContent = msg;
        notification.className =
          "notification" + (type === "error" ? " error" : "");
        notification.classList.add("show");
        setTimeout(() => notification.classList.remove("show"), 3200);
      }

      function setupEventListeners() {
        addAgentBtn.addEventListener("click", () => {
          newAgentName.value = "";
          newAgentPhoto.value = "";
          newAgentDescription.value = "";
          addAgentModal.style.display = "flex";
        });

        confirmAddAgent.addEventListener("click", addNewAgent);
        cancelAddAgent.addEventListener(
          "click",
          () => (addAgentModal.style.display = "none"),
        );

        backBtn.addEventListener("click", () => {
          profileView.style.display = "none";
          mainView.style.display = "block";
          loadAgents();
        });

        balanceContainer.addEventListener("click", () => {
          balanceChangeValue.value = "";
          editBalanceModal.style.display = "flex";
        });

        confirmBalanceEdit.addEventListener("click", saveBalanceChange);
        cancelBalanceEdit.addEventListener(
          "click",
          () => (editBalanceModal.style.display = "none"),
        );

        exportBtn.addEventListener("click", exportDatabase);
        importBtn.addEventListener("click", () => fileInput.click());
        fileInput.addEventListener("change", importDatabase);

        header.addEventListener("click", () => {
          if (profileView.style.display === "block") {
            profileView.style.display = "none";
            mainView.style.display = "block";
            loadAgents();
          }
        });

        copyBtn.addEventListener("click", copyAgentData);
        avatarContainer.addEventListener("click", editAvatar);

        agentNameInput.addEventListener("input", autoSaveAgent);
        agentDescriptionInput.addEventListener("input", autoSaveAgent);
        agentStatusSelect.addEventListener("change", autoSaveAgent);

        deleteAgentBtn.addEventListener("click", () => {
          if (!currentAgentId) return;
          const agents =
            JSON.parse(localStorage.getItem(getStorageKey("assassinAgents"))) ||
            [];
          const agent = agents.find((a) => a.id === currentAgentId);
          if (agent) {
            agentToDeleteId = currentAgentId;
            deleteAgentNameDisplay.textContent = agent.name;
            deleteAgentModal.style.display = "flex";
          }
        });

        confirmDeleteAgent.addEventListener("click", () => {
          if (!agentToDeleteId) return;
          let agents =
            JSON.parse(localStorage.getItem(getStorageKey("assassinAgents"))) ||
            [];
          agents = agents.filter((a) => a.id !== agentToDeleteId);
          localStorage.setItem(
            getStorageKey("assassinAgents"),
            JSON.stringify(agents),
          );
          showNotification("–ê–≥–µ–Ω—Ç —É–¥–∞–ª—ë–Ω");
          deleteAgentModal.style.display = "none";
          profileView.style.display = "none";
          mainView.style.display = "block";
          loadAgents();
          agentToDeleteId = null;
        });

        cancelDeleteAgent.addEventListener("click", () => {
          deleteAgentModal.style.display = "none";
          agentToDeleteId = null;
        });
      }
    </script>
  </body>
</html>
